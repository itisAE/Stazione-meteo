<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="{{ url_for('static', filename='images/logo.png') }}" type="image/png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Station API - ITIS Mario Delpozzo</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .weather-icon {
            font-size: 3.5rem;
        }
        .temp-display {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .custom-card {
            transition: transform 0.3s;
        }
        .custom-card:hover {
            transform: translateY(-5px);
        }
        .bg-school {
            background-color: #0d6efd;
        }
        .no-wrap {
            white-space: nowrap;
        }
        
        /* Additional styles for API page */
        .hero {
            background: linear-gradient(135deg, #0d6efd 0%, #6f42c1 100%);
            color: white;
            padding: 80px 0;
        }
        
        .hero h1 {
            font-size: 3.5em;
            font-weight: 300;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .hero .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 30px;
            font-style: italic;
        }
        
        .hero .quote {
            font-size: 1.1em;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
            border-left: 3px solid rgba(255, 255, 255, 0.4);
            padding-left: 20px;
            text-align: left;
        }
        
        .section-title {
            color: #6f42c1;
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 40px;
            background: linear-gradient(135deg, #0d6efd, #6f42c1);
            margin-right: 15px;
            border-radius: 2px;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            position: relative;
        }
        
        .code-block::before {
            content: 'JSON';
            position: absolute;
            top: 10px;
            right: 15px;
            background: #0d6efd;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }
        
        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .endpoint {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        
        .endpoint h4 {
            color: #1565c0;
            margin-bottom: 10px;
        }
        
        .parameter {
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
        }
        
        .parameter strong {
            color: #6f42c1;
        }
        
        .calculator-form .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .calculator-form .form-row .form-group {
            flex: 1;
        }
        
        .precision-input-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .precision-symbol {
            font-weight: bold;
            color: #6f42c1;
        }
        
        .precision-unit {
            min-width: 30px;
            font-weight: bold;
            color: #6f42c1;
        }
        
        .precision-hint {
            font-size: 0.875em;
            color: #6c757d;
            margin-top: 5px;
            display: block;
        }
        
        .accuracy-result {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #0d6efd;
        }
        
        .result-header h3 {
            color: #0d6efd;
            margin-bottom: 20px;
        }
        
        .accuracy-value {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .accuracy-percentage {
            font-size: 3em;
            font-weight: bold;
            color: #0d6efd;
        }
        
        .result-breakdown {
            margin-bottom: 20px;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .json-example h4 {
            color: #6f42c1;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5em;
            }
            
            .calculator-form .form-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-school">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="./">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" style="height: 40px;" class="me-2">
                <span>Weather Station ITIS Mario Delpozzo</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="./">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./archivio-dati">Data Archive</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./dati_live">Live Data</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./progetto">The Project</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="./csp">Citizen Science Platform</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://www.itiscuneo.edu.it/" target="_blank">The School</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero">
        <div class="container text-center">
            <h1>üå§Ô∏è Weather Station API</h1>
            <div class="subtitle">ITIS Mario Delpozzo Project - Citizen Science Platform</div>
            <div class="quote">
                "From Torricelli's first barometer in 1643 to today's supercomputers, meteorology has always depended on one thing: data. Today, every citizen can become part of this scientific revolution." - Edward Lorenz
            </div>
        </div>
    </div>

    <!-- Header with station info -->
    <div class="bg-light py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h2 class="mb-2">API Documentation & Token Request</h2>
                    <p class="lead mb-0">Contribute to weather forecasting through citizen science</p>
                    <p>Cuneo, Piedmont - Educational weather monitoring project</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="d-flex flex-column align-items-md-end">
                        <div class="mb-1">Platform Status: 
                            <span class="fw-bold text-success">Active</span>
                        </div>
                        <div>
                            <span class="badge bg-success">API Online</span>
                            <a href="/dati_live" class="btn btn-sm btn-outline-primary ms-2">Live Data</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container my-5">
        <!-- Why APIs Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h2 class="section-title">üî¨ Why APIs?</h2>
                <p>The future of weather forecasting doesn't lie only in more powerful machines, but in expanding our sensor network to include the greatest resource at our disposal: <strong>you</strong>.</p>
                
                <p><strong>Citizen science</strong> represents collaboration between professional scientists and the public for scientific research. In meteorology, this means actively involving people in collecting atmospheric data. Our project serves as the foundation for this fundamental implementation:</p>
                
                <ul class="mt-3">
                    <li><strong>Distributed sensor network:</strong> Private weather stations provide valuable local-scale data, increasing the spatial resolution of measurements</li>
                    <li><strong>Improved nowcasting:</strong> Real-time observations for very short-term forecasts (2-3 hours)</li>
                    <li><strong>Model validation:</strong> Data collected by citizens calibrates and improves the accuracy of our Machine Learning algorithms</li>
                </ul>
                
                <p>Every small data contribution can make a difference in overcoming the main obstacle in weather forecasting: the scarcity of quality data.</p>
            </div>
        </div>

        <!-- Token Request Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <h2 class="h5 mb-0">üîë Request Your API Token</h2>
            </div>
            <div class="card-body">
                <p>Enter your email to receive a personal token to use in API calls:</p>
                
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label for="email" class="form-label">Email:</label>
                        <input type="email" class="form-control" id="email" placeholder="your-email@example.com" required>
                    </div>
                    <div class="col-md-6">
                        <label for="name" class="form-label">Station Name (optional):</label>
                        <input type="text" class="form-control" id="name" placeholder="Home Weather Station">
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="requestToken()">Request Token</button>
                
                <div id="status-message" class="status-message"></div>
            </div>
        </div>

        <!-- Sensor Accuracy Calculator -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <h2 class="h5 mb-0">üéØ Sensor Accuracy Calculator</h2>
            </div>
            <div class="card-body">
                <p>Use this tool to calculate the accuracy percentage of your sensors to include in API calls:</p>
                
                <div class="accuracy-calculator">
                    <div class="calculator-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sensor-type" class="form-label">Sensor Type:</label>
                                <select class="form-select" id="sensor-type" onchange="updatePrecisionRange()">
                                    <option value="">Select sensor...</option>
                                    <option value="temperature">Temperature</option>
                                    <option value="humidity">Humidity</option>
                                    <option value="pressure">Atmospheric Pressure</option>
                                    <option value="wind_speed">Wind Speed</option>
                                    <option value="wind_direction">Wind Direction</option>
                                    <option value="precipitation">Precipitation</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="sensor-model" class="form-label">Sensor Model:</label>
                                <select class="form-select" id="sensor-model" onchange="updatePrecisionRange()">
                                    <option value="">Select model...</option>
                                    <option value="davis_vantage_pro2">Davis Vantage Pro2</option>
                                    <option value="davis_vantage_vue">Davis Vantage Vue</option>
                                    <option value="oregon_scientific">Oregon Scientific</option>
                                    <option value="lacrosse">La Crosse Technology</option>
                                    <option value="ambient_weather">Ambient Weather</option>
                                    <option value="generic_professional">Generic Professional Station</option>
                                    <option value="generic_consumer">Generic Consumer Station</option>
                                    <option value="diy_sensor">DIY/Handmade Sensor</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sensor-precision" class="form-label">Declared Precision:</label>
                                <div class="precision-input-group">
                                    <span class="precision-symbol">¬±</span>
                                    <input type="number" class="form-control" id="sensor-precision" step="0.1" placeholder="0.0">
                                    <span id="precision-unit" class="precision-unit">-</span>
                                </div>
                                <small id="precision-hint" class="precision-hint">Enter the precision from the sensor manual</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="calibration-age" class="form-label">Last Calibration:</label>
                                <select class="form-select" id="calibration-age">
                                    <option value="0">Calibrated today</option>
                                    <option value="30">Calibrated 1 month ago</option>
                                    <option value="90">Calibrated 3 months ago</option>
                                    <option value="180">Calibrated 6 months ago</option>
                                    <option value="365">Calibrated 1 year ago</option>
                                    <option value="730">Calibrated 2 years ago</option>
                                    <option value="1095">Never calibrated/More than 3 years</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="installation-age" class="form-label">Installation Age:</label>
                                <select class="form-select" id="installation-age">
                                    <option value="0">Just installed</option>
                                    <option value="180">6 months</option>
                                    <option value="365">1 year</option>
                                    <option value="730">2 years</option>
                                    <option value="1095">3 years</option>
                                    <option value="1825">5 years</option>
                                    <option value="2555">More than 7 years</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="environmental-conditions" class="form-label">Environmental Conditions:</label>
                                <select class="form-select" id="environmental-conditions">
                                    <option value="optimal">Optimal Conditions</option>
                                    <option value="normal">Normal Conditions</option>
                                    <option value="challenging">Challenging Conditions (strong wind, rain)</option>
                                    <option value="extreme">Extreme Conditions (frost, intense heat)</option>
                                </select>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary mt-3" onclick="calculateAccuracy()">Calculate Accuracy</button>
                    </div>
                    
                    <div id="accuracy-result" class="accuracy-result" style="display: none;">
                        <div class="result-header">
                            <h3>üìä Calculation Result</h3>
                        </div>
                        <div class="result-content">
                            <div class="accuracy-value">
                                <span class="accuracy-percentage" id="final-accuracy">-</span>%
                            </div>
                            <div class="result-breakdown">
                                <h4>Calculation breakdown:</h4>
                                <div class="breakdown-item">
                                    <span>Base model accuracy:</span>
                                    <span id="base-accuracy">-</span>%
                                </div>
                                <div class="breakdown-item">
                                    <span>Calibration penalty:</span>
                                    <span id="calibration-penalty">-</span>%
                                </div>
                                <div class="breakdown-item">
                                    <span>Installation age penalty:</span>
                                    <span id="age-penalty">-</span>%
                                </div>
                                <div class="breakdown-item">
                                    <span>Environmental factor:</span>
                                    <span id="environmental-factor">-</span>%
                                </div>
                            </div>
                            <div class="json-example">
                                <h4>Insert this value in the JSON:</h4>
                                <div class="code-block" style="margin: 10px 0;">
"<span id="sensor-field-name">sensor</span>": {
  "value": YOUR_VALUE,
  "accuracy": <span id="json-accuracy">0.0</span>,
  "unit": "<span id="sensor-unit">unit</span>"
}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Usage Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <h2 class="h5 mb-0">üì° How to Use the APIs</h2>
            </div>
            <div class="card-body">
                <p>Our APIs allow you to send meteorological data to the system to improve Machine Learning-based forecasts.</p>
                
                <div class="endpoint">
                    <h4>POST /api/weather-data</h4>
                    <p><strong>Endpoint:</strong> <code>https://api.stazione-meteo.itis-delpozzo.it/weather-data</code></p>
                    <p><strong>Content-Type:</strong> application/json</p>
                </div>

                <div class="alert alert-info">
                    <h5>Required Headers:</h5>
                    <div class="code-block">
{
  "Authorization": "Bearer YOUR_TOKEN",
  "Content-Type": "application/json"
}</div>
                </div>

                <div class="alert alert-info">
                    <h5>JSON Data Structure:</h5>
                    <div class="code-block">
{
  "timestamp": "2025-09-12T14:30:00Z",
  "location": {
    "latitude": 44.5675,
    "longitude": 7.4823,
    "altitude": 425
  },
  "data": {
    "temperature": {
      "value": 23.5,
      "accuracy": 95.0,
      "unit": "celsius"
    },
    "humidity": {
      "value": 68.2,
      "accuracy": 90.0,
      "unit": "percent"
    },
    "pressure": {
      "value": 1013.25,
      "accuracy": 98.5,
      "unit": "hPa"
    },
    "wind_speed": {
      "value": 12.3,
      "accuracy": 85.0,
      "unit": "km/h"
    },
    "wind_direction": {
      "value": 245,
      "accuracy": 80.0,
      "unit": "degrees"
    },
    "precipitation": {
      "value": 0.0,
      "accuracy": 92.0,
      "unit": "mm"
    }
  },
  "sensor_info": {
    "model": "Davis Vantage Pro2",
    "firmware_version": "1.2.3"
  }
}</div>
                </div>

                <h5>Required Parameters:</h5>
                <div class="parameter">
                    <strong>timestamp:</strong> Date and time of reading in ISO 8601 UTC format
                </div>
                <div class="parameter">
                    <strong>location:</strong> Precise geographic coordinates of the station
                </div>
                <div class="parameter">
                    <strong>unit:</strong> Unit of measurement (celsius, percent, hPa, km/h, degrees, mm)
                </div>
                <div class="parameter">
                    <strong>accuracy:</strong> Accuracy percentage for each sensor (0-100%)
                    <br><em>This parameter is crucial for evaluating data reliability in our ML algorithm</em>
                </div>

                <h5>Example curl call:</h5>
                <div class="code-block">
curl -X POST https://api.stazione-meteo.itis-delpozzo.it/weather-data \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d @weather-data.json</div>

                <h5>API Responses:</h5>
                <div class="parameter">
                    <strong>200 OK:</strong> Data received and processed successfully
                </div>
                <div class="parameter">
                    <strong>401 Unauthorized:</strong> Missing or invalid token
                </div>
                <div class="parameter">
                    <strong>400 Bad Request:</strong> Invalid data format
                </div>
                <div class="parameter">
                    <strong>429 Too Many Requests:</strong> Rate limiting threshold reached
                </div>
            </div>
        </div>

        <!-- Contribution Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <h2 class="h5 mb-0">üåç Contribute to the Future of Meteorology</h2>
            </div>
            <div class="card-body">
                <p>Every data point you send through these APIs contributes to:</p>
                <ul>
                    <li>Improving the accuracy of local forecasts</li>
                    <li>Providing data for nowcasting (2-3 hour forecasts)</li>
                    <li>Validating and perfecting our Machine Learning models</li>
                    <li>Creating a distributed weather network across the territory</li>
                </ul>
                <p><em>The meteorology of the future will be a participatory science, where every person can be part of the solution.</em></p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>ITIS Mario Delpozzo - Weather Station</h5>
                    <address>
                        <i class="fas fa-map-marker-alt me-2"></i> Corso Alcide De Gasperi, 30 - 12100 Cuneo<br>
                        <i class="fas fa-phone me-2"></i> Phone: 0171 634091<br>
                        <i class="fas fa-envelope me-2"></i> Email: stazionemeteo@itisdelpozzo.edu.it
                    </address>
                </div>
                <div class="col-md-6 text-md-end">
                    <h5>Quick Links</h5>
                    <ul class="list-inline">
                        <li class="list-inline-item"><a href="./" class="text-white">Home</a></li>
                        <li class="list-inline-item"><a href="./archivio-dati" class="text-white">Data Archive</a></li>
                        <li class="list-inline-item"><a href="./dati_live" class="text-white">Live Data</a></li>
                        <li class="list-inline-item"><a href="./progetto" class="text-white">The Project</a></li>
                        <li class="list-inline-item"><a href="./csp" class="text-white">Citizen Science Platform</a></li>
                        <li class="list-inline-item"><a href="https://www.itiscuneo.edu.it/" class="text-white" target="_blank">The School</a></li>
                    </ul>
                    <div class="mt-3">
                        <a href="https://www.facebook.com/ITISdelpozzo/" class="text-white me-2"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-white me-2"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-white me-2"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.youtube.com/@itisdelpozzocuneo3140" class="text-white"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-3">
            <div class="text-center">
                <small>¬© 2025 ITIS Mario Delpozzo - Weather Station of Cuneo. Developed by students of the Robotics track.</small>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Token request function
        function requestToken() {
            const email = document.getElementById('email').value;
            const name = document.getElementById('name').value;
            const statusMessage = document.getElementById('status-message');
            const button = document.querySelector('.btn-primary');

            const data = {
                email: email,
                name: name
            };

            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            };

            button.disabled = true;
            statusMessage.textContent = 'Request in progress...';
            statusMessage.className = 'status-message alert alert-info';
            statusMessage.style.display = 'block';

            fetch('/request-token', options)
                .then(response => {
                    button.disabled = false;
                    if (!response.ok) {
                        return response.json().then(err => {
                            throw new Error(err.message || 'Server error');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    statusMessage.textContent = data.message;
                    statusMessage.className = 'status-message alert alert-success';
                })
                .catch(error => {
                    button.disabled = false;
                    statusMessage.textContent = `Error: ${error.message}`;
                    statusMessage.className = 'status-message alert alert-danger';
                    console.error('An error occurred:', error);
                });
        }

        // Sensor database
        const sensorDatabase = {
            temperature: {
                unit: '¬∞C',
                fieldName: 'temperature',
                models: {
                    davis_vantage_pro2: { precision: 0.3, baseAccuracy: 99 },
                    davis_vantage_vue: { precision: 0.5, baseAccuracy: 97 },
                    oregon_scientific: { precision: 1.0, baseAccuracy: 90 },
                    lacrosse: { precision: 1.0, baseAccuracy: 88 },
                    ambient_weather: { precision: 0.5, baseAccuracy: 95 },
                    generic_professional: { precision: 0.5, baseAccuracy: 94 },
                    generic_consumer: { precision: 1.5, baseAccuracy: 85 },
                    diy_sensor: { precision: 2.0, baseAccuracy: 75 }
                }
            },
            humidity: {
                unit: '%',
                fieldName: 'humidity',
                models: {
                    davis_vantage_pro2: { precision: 2, baseAccuracy: 95 },
                    davis_vantage_vue: { precision: 3, baseAccuracy: 92 },
                    oregon_scientific: { precision: 5, baseAccuracy: 85 },
                    lacrosse: { precision: 5, baseAccuracy: 83 },
                    ambient_weather: { precision: 3, baseAccuracy: 90 },
                    generic_professional: { precision: 3, baseAccuracy: 88 },
                    generic_consumer: { precision: 7, baseAccuracy: 80 },
                    diy_sensor: { precision: 10, baseAccuracy: 70 }
                }
            },
            pressure: {
                unit: 'hPa',
                fieldName: 'pressure',
                models: {
                    davis_vantage_pro2: { precision: 1, baseAccuracy: 98 },
                    davis_vantage_vue: { precision: 1.5, baseAccuracy: 96 },
                    oregon_scientific: { precision: 3, baseAccuracy: 90 },
                    lacrosse: { precision: 3, baseAccuracy: 88 },
                    ambient_weather: { precision: 1.5, baseAccuracy: 95 },
                    generic_professional: { precision: 2, baseAccuracy: 93 },
                    generic_consumer: { precision: 5, baseAccuracy: 85 },
                    diy_sensor: { precision: 8, baseAccuracy: 75 }
                }
            },
            wind_speed: {
                unit: 'km/h',
                fieldName: 'wind_speed',
                models: {
                    davis_vantage_pro2: { precision: 1, baseAccuracy: 92 },
                    davis_vantage_vue: { precision: 2, baseAccuracy: 88 },
                    oregon_scientific: { precision: 3, baseAccuracy: 82 },
                    lacrosse: { precision: 3, baseAccuracy: 80 },
                    ambient_weather: { precision: 2, baseAccuracy: 85 },
                    generic_professional: { precision: 2.5, baseAccuracy: 87 },
                    generic_consumer: { precision: 5, baseAccuracy: 75 },
                    diy_sensor: { precision: 8, baseAccuracy: 65 }
                }
            },
            wind_direction: {
                unit: '¬∞',
                fieldName: 'wind_direction',
                models: {
                    davis_vantage_pro2: { precision: 3, baseAccuracy: 87 },
                    davis_vantage_vue: { precision: 5, baseAccuracy: 83 },
                    oregon_scientific: { precision: 10, baseAccuracy: 75 },
                    lacrosse: { precision: 10, baseAccuracy: 73 },
                    ambient_weather: { precision: 5, baseAccuracy: 80 },
                    generic_professional: { precision: 7, baseAccuracy: 82 },
                    generic_consumer: { precision: 15, baseAccuracy: 70 },
                    diy_sensor: { precision: 20, baseAccuracy: 60 }
                }
            },
            precipitation: {
                unit: 'mm',
                fieldName: 'precipitation',
                models: {
                    davis_vantage_pro2: { precision: 0.2, baseAccuracy: 96 },
                    davis_vantage_vue: { precision: 0.2, baseAccuracy: 94 },
                    oregon_scientific: { precision: 0.5, baseAccuracy: 88 },
                    lacrosse: { precision: 0.5, baseAccuracy: 86 },
                    ambient_weather: { precision: 0.3, baseAccuracy: 91 },
                    generic_professional: { precision: 0.3, baseAccuracy: 90 },
                    generic_consumer: { precision: 1, baseAccuracy: 82 },
                    diy_sensor: { precision: 2, baseAccuracy: 70 }
                }
            }
        };

        function updatePrecisionRange() {
            const sensorType = document.getElementById('sensor-type').value;
            const sensorModel = document.getElementById('sensor-model').value;
            const precisionInput = document.getElementById('sensor-precision');
            const unitSpan = document.getElementById('precision-unit');
            const hintSpan = document.getElementById('precision-hint');
            
            if (sensorType && sensorDatabase[sensorType]) {
                const unit = sensorDatabase[sensorType].unit;
                unitSpan.textContent = unit;
                
                if (sensorModel && sensorDatabase[sensorType].models[sensorModel]) {
                    const modelData = sensorDatabase[sensorType].models[sensorModel];
                    precisionInput.value = modelData.precision;
                    hintSpan.textContent = `Suggested precision for this model: ¬±${modelData.precision} ${unit}`;
                } else {
                    precisionInput.value = '';
                    hintSpan.textContent = 'Enter the precision from the sensor manual';
                }
            } else {
                unitSpan.textContent = '-';
                precisionInput.value = '';
                hintSpan.textContent = 'Select the sensor type first';
            }
        }

        function calculateAccuracy() {
            const sensorType = document.getElementById('sensor-type').value;
            const sensorModel = document.getElementById('sensor-model').value;
            const precision = parseFloat(document.getElementById('sensor-precision').value);
            const calibrationAge = parseInt(document.getElementById('calibration-age').value);
            const installationAge = parseInt(document.getElementById('installation-age').value);
            const environmentalConditions = document.getElementById('environmental-conditions').value;
            
            if (!sensorType || !sensorModel || !precision) {
                alert('Fill in all required fields');
                return;
            }
            
            // 1. Base model accuracy
            let baseAccuracy = sensorDatabase[sensorType].models[sensorModel].baseAccuracy;
            
            // 2. Calibration penalty
            let calibrationPenalty = 0;
            if (calibrationAge > 365) calibrationPenalty = 15;
            else if (calibrationAge > 180) calibrationPenalty = 8;
            else if (calibrationAge > 90) calibrationPenalty = 4;
            else if (calibrationAge > 30) calibrationPenalty = 2;
            
            // 3. Installation age penalty
            let agePenalty = 0;
            if (installationAge > 1825) agePenalty = 20;
            else if (installationAge > 1095) agePenalty = 12;
            else if (installationAge > 730) agePenalty = 8;
            else if (installationAge > 365) agePenalty = 4;
            else if (installationAge > 180) agePenalty = 2;
            
            // 4. Environmental factor
            let environmentalFactor = 0;
            switch (environmentalConditions) {
                case 'optimal': environmentalFactor = 2; break;
                case 'normal': environmentalFactor = 0; break;
                case 'challenging': environmentalFactor = -5; break;
                case 'extreme': environmentalFactor = -12; break;
            }
            
            // 5. Custom precision factor
            const standardPrecision = sensorDatabase[sensorType].models[sensorModel].precision;
            let precisionFactor = 0;
            if (precision < standardPrecision) {
                precisionFactor = 3; // More precise sensor than normal
            } else if (precision > standardPrecision * 1.5) {
                precisionFactor = -8; // Less precise sensor
            }
            
            // Final calculation
            const finalAccuracy = Math.max(
                Math.min(
                    baseAccuracy - calibrationPenalty - agePenalty + environmentalFactor + precisionFactor, 
                    99
                ), 
                50
            );
            
            // Show results
            document.getElementById('final-accuracy').textContent = finalAccuracy.toFixed(1);
            document.getElementById('base-accuracy').textContent = baseAccuracy;
            document.getElementById('calibration-penalty').textContent = `-${calibrationPenalty}`;
            document.getElementById('age-penalty').textContent = `-${agePenalty}`;
            document.getElementById('environmental-factor').textContent = environmentalFactor > 0 ? `+${environmentalFactor}` : environmentalFactor;
            document.getElementById('sensor-field-name').textContent = sensorDatabase[sensorType].fieldName;
            document.getElementById('json-accuracy').textContent = finalAccuracy.toFixed(1);
            document.getElementById('sensor-unit').textContent = sensorDatabase[sensorType].unit;
            
            document.getElementById('accuracy-result').style.display = 'block';
        }

        // Page load animations
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.card');
            
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            });
            
            cards.forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px)';
                card.style.transition = 'all 0.6s ease';
                observer.observe(card);
            });
        });
    </script>
</body>
</html>