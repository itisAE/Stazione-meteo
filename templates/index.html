<!DOCTYPE html>
<!-- 
To reduce development time, we relied on Claude AI for generating the basic site structure and CSS (using Bootstrap).
We then customized everything to fit our needs.
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Station ITIS Mario Delpozzo - Cuneo</title>
    <link rel="icon" href="{{ url_for('static', filename='images/logo.png') }}" type="image/png">
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .weather-icon {
            font-size: 3.5rem;
        }
        .temp-display {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .custom-card {
            transition: transform 0.3s;
        }
        .custom-card:hover {
            transform: translateY(-5px);
        }
        .bg-school {
            background-color: #0d6efd;
        }
        /* Solution 1: Add this style to prevent line breaks */
        .no-wrap {
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-school">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="./">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" style="height: 40px;" class="me-2">
                <span>Weather Station ITIS Mario Delpozzo</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="./">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./data_archive">Data Archive</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href = "./live_data">Live Data</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./project">The Project</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./csp">Citizen science platform</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://www.itiscuneo.edu.it/" target="_blank">The School</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Header with station info -->
    <div class="bg-light py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2">Weather Station ITIS Mario Delpozzo</h1>
                    <p class="lead mb-0">Educational weather monitoring project</p>
                    <p>Cuneo, Piedmont - Altitude: 534 m a.s.l.</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="d-flex flex-column align-items-md-end">
                        
                        <div class="mb-1">Updated: 
                        <span id="current-date" class="fw-bold">
                            {% if data and data|length > 0 and data[0]|length >= 2 and data[0][0] and data[0][1] %}
                                {{data[0][0]}} {{data[0][1]}}
                            {% else %}
                                <span class="text-muted">Time not available</span>
                            {% endif %}
                        </span>
                        </div>
                        <div>
                            <span class="badge bg-{{data[2][0]}}">Station {{data[2][1]}}</span>
                            <a href="/live_data" class="btn btn-sm btn-outline-primary ms-2">Live Data</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Current data -->
<div class="container my-4">
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0"><i class="fas fa-calendar-day me-2"></i>Latest collected data</h2>
            <h2 class="h6 mb-0">Recorded on: 
                {% if data[0][0] and data[0][1] %}
                  {{data[0][0]}} {{data[0][1]}}   
                {% else %}
                    <span class="text-muted">Time not available</span>
                {% endif %}
            </h2>
        </div>
        <div class="card-body">
            {% if data[1] is not none %}
            <div class="row">
                <div class="col-md-4 text-center border-end">
                    {% set weather_data = {
                        "temperatura": data[1]["outside_temp"]|float,
                        "precipitazione": data[1]["rain_rate"]|float,
                        "velocità media": data[1]["wind_speed"]|float,
                        "velocità raffica": data[1]["raffica"]|float if data[1]["raffica"] else 0,
                        "umidità": data[1]["outside_humidity"]|float,
                        "pressione": data[1]["barometer"]|float
                    } %}
                    
                    {% set emoji, description = get_weather_emoji_and_description(weather_data) %}
                    
                    <div class="weather-icon mb-2">{{ emoji }}</div>
                    <div class="h4">{{ description }}</div>
                    <div class="temp-display">{{data[1]["outside_temp"]}}°C</div>
                    <div id="temp">Feels like: {{data[1]["temp_perc"]}}°C</div>
                </div>
                <div class="col-md-8">
                    <!-- The rest of the code remains unchanged -->
                    <div class="row row-cols-2 row-cols-lg-5 g-3 text-center">
                        <div class="col">
                            <div class="card h-100 border-0">
                                <div class="card-body">
                                    <i class="fas fa-temperature-high text-danger mb-2" style="font-size: 1.5rem;"></i>
                                    <h5 class="card-title">Temperature</h5>
                                    <p class="card-text mb-0">Current: {{data[1]["outside_temp"]}}°C</p>
                                    <p class="card-text mb-0">Min: {{data[1]["min_temp"]}}°C</p>
                                    <p class="card-text">Max: {{data[1]["max_temp"]}}°C</p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="card h-100 border-0">
                                <div class="card-body">
                                    <i class="fas fa-wind text-primary mb-2" style="font-size: 1.5rem;"></i>
                                    <h5 class="card-title">Wind</h5>
                                    <p class="card-text mb-0">{{data[1]["wind_speed"]}} Km/h</p>
                                    <p class="card-text mb-0">Direction: {{data[1]["wind_direction"]}}</p>
                                    
                                    {%if data[1]["raffica"] != None %}    <!-- If gust is not found, we don't display it -->
                                        <p class="card-text">Gust: {{data[1]["raffica"]}} Km/h at: {{data[1]["orario_raffica"]}}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="card h-100 border-0">
                                <div class="card-body">
                                    <i class="fas fa-tint text-info mb-2" style="font-size: 1.5rem;"></i>
                                    <h5 class="card-title">Humidity</h5>
                                    <p class="card-text mb-0">{{data[1]["outside_humidity"]}}%</p>
                                    <p class="card-text mb-0">Dew point:</p>
                                    <p class="card-text">{{data[1]["punto_di_rugiada"]}}°C</p>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="card h-100 border-0">
                                <div class="card-body">
                                    <i class="fas fa-tachometer-alt text-success mb-2" style="font-size: 1.5rem;"></i>
                                    <h5 class="card-title">Pressure</h5>
                                    <p class="card-text mb-0">{{data[1]["barometer"]}} hPa</p>
                                    {%if data[1]["bar_trend"] != "Unknown (255)" %} <!-- If trend is not detected in the latest station reading, we don't display it-->
                                        <p class="card-text mb-0">Trend:</p>
                                        <p class="card-text">{{data[1]["bar_trend"]}}</p>
                                    {% endif%}
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="card h-100 border-0">
                                <div class="card-body">
                                    <i class="fas fa-cloud-showers-heavy text-primary mb-2" style="font-size: 1.5rem;"></i>
                                    <!-- Solution 1: Add the no-wrap class -->
                                    <h5 class="card-title no-wrap">Precipitation</h5>
                                    <p class="card-text mb-0">{{data[1]["rain_rate"]}} mm/h
                                        </p>
                                    <p class="card-text mb-0">Today: {{data[1]["day_rain"]}} mm</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <!-- Nessun dato disponibile -->
            <div class="row">
                <div class="col-12 text-center">
                    <div class="alert alert-warning" role="alert">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                        <h4>No meteorological data available</h4>
                        <p>The weather station is currently not connected or there is no historical data available in the database.</p>
                        <p>Please check back later for updates.</p>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

    <!-- 3-day forecast -->
<div class="container my-4">
    <h2 class="h4 mb-3"><i class="fas fa-calendar-week me-2"></i>Weather Forecast - Next Days</h2>
    <div class="row row-cols-1 row-cols-md-3 g-4 mb-4">

        <!-- Day 1 -->
        <div class="col">
            <div class="card h-100 shadow-sm custom-card">
                <div class="card-header text-center bg-primary text-white">
                    <h3 class="h5 mb-0">{{ giorni["domani_g"] }}</h3>
                </div>
                <div class="card-body text-center">
                    {% if domani %}
                    {% set domani_weather = {
                        "temperatura": domani["temperatura"]|float,
                        "precipitazione": domani["precipitazione"]|float,
                        "velocità media": domani["velocità media"]|float,
                        "velocità raffica": domani.get("velocità raffica", 0)|float,
                        "umidità": domani["umidità"]|float,
                        "pressione": domani["pressione"]|float
                    } %}
                    
                    {% set domani_emoji, domani_desc = get_weather_emoji_and_description(domani_weather) %}
                    
                    <div class="weather-icon mb-2">{{ domani_emoji }}</div>
                    <div class="h4">{{ domani_desc }}</div>
                    <div class="temp-display mb-2">{{ domani["temperatura"] }}°C</div>
                    <div class="row row-cols-2 g-2 text-center mb-2">
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tint text-info"></i> {{ domani["umidità"] }} %
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-wind text-primary"></i> {{ domani["velocità media"] }} Km/h
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tachometer-alt text-success"></i> {{ domani["pressione"] }} hPa
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-cloud-rain text-secondary"></i> {{ domani["precipitazione"] }} mm
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="weather-icon mb-2">-</div>
                    <div class="h4">Data not available</div>
                    <div class="temp-display mb-2">- °C</div>
                    <div class="row row-cols-2 g-2 text-center mb-2">
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tint text-info"></i> - %
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-wind text-primary"></i> - Km/h
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tachometer-alt text-success"></i> - hPa
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-cloud-rain text-secondary"></i> - mm
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Day 2 -->
        <div class="col">
            <div class="card h-100 shadow-sm custom-card">
                <div class="card-header text-center bg-primary text-white">
                    <h3 class="h5 mb-0">{{ giorni["dopodomani_g"] }}</h3>
                </div>
                <div class="card-body text-center">
                    {% if dopodomani %}
                    {% set dopodomani_weather = {
                        "temperatura": dopodomani["temperatura"]|float,
                        "precipitazione": dopodomani["precipitazione"]|float,
                        "velocità media": dopodomani["velocità media"]|float,
                        "velocità raffica": dopodomani.get("velocità raffica", 0)|float,
                        "umidità": dopodomani["umidità"]|float,
                        "pressione": dopodomani["pressione"]|float
                    } %}
                    
                    {% set dopodomani_emoji, dopodomani_desc = get_weather_emoji_and_description(dopodomani_weather) %}
                    
                    <div class="weather-icon mb-2">{{ dopodomani_emoji }}</div>
                    <div class="h4">{{ dopodomani_desc }}</div>
                    <div class="temp-display mb-2">{{ dopodomani["temperatura"] }}°C</div>
                    <div class="row row-cols-2 g-2 text-center mb-2">
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tint text-info"></i> {{ dopodomani["umidità"] }}%
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-wind text-primary"></i> {{ dopodomani["velocità media"] }} Km/h
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tachometer-alt text-success"></i> {{ dopodomani["pressione"] }} hPa
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-cloud-rain text-secondary"></i> {{ dopodomani["precipitazione"] }} mm
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="weather-icon mb-2">-</div>
                    <div class="h4">Data not available</div>
                    <div class="temp-display mb-2">- °C</div>
                    <div class="row row-cols-2 g-2 text-center mb-2">
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tint text-info"></i> - %
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-wind text-primary"></i> - Km/h
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tachometer-alt text-success"></i> - hPa
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-cloud-rain text-secondary"></i> - mm
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Day 3 -->
        <div class="col">
            <div class="card h-100 shadow-sm custom-card">
                <div class="card-header text-center bg-primary text-white">
                    <h3 class="h5 mb-0">{{ giorni["tra_tre_giorni_g"] }}</h3>
                </div>
                <div class="card-body text-center">
                    {% if tregiorni %}
                    {% set tregiorni_weather = {
                        "temperatura": tregiorni["temperatura"]|float,
                        "precipitazione": tregiorni["precipitazione"]|float,
                        "velocità media": tregiorni["velocità media"]|float,
                        "velocità raffica": tregiorni.get("velocità raffica", 0)|float,
                        "umidità": tregiorni["umidità"]|float,
                        "pressione": tregiorni["pressione"]|float
                    } %}
                    
                    {% set tregiorni_emoji, tregiorni_desc = get_weather_emoji_and_description(tregiorni_weather) %}
                    
                    <div class="weather-icon mb-2">{{ tregiorni_emoji }}</div>
                    <div class="h4">{{ tregiorni_desc }}</div>
                    <div class="temp-display mb-2">{{ tregiorni["temperatura"] }}°C</div>
                    <div class="row row-cols-2 g-2 text-center mb-2">
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tint text-info"></i> {{ tregiorni["umidità"] }}%
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-wind text-primary"></i> {{ tregiorni["velocità media"] }} km/h
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tachometer-alt text-success"></i> {{ tregiorni["pressione"] }} hPa
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-cloud-rain text-secondary"></i> {{ tregiorni["precipitazione"] }} mm
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="weather-icon mb-2">-</div>
                    <div class="h4">Data not available</div>
                    <div class="temp-display mb-2">- °C</div>
                    <div class="row row-cols-2 g-2 text-center mb-2">
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tint text-info"></i> - %
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-wind text-primary"></i> - Km/h
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-tachometer-alt text-success"></i> - hPa
                            </div>
                        </div>
                        <div class="col">
                            <div class="p-2 bg-light rounded">
                                <i class="fas fa-cloud-rain text-secondary"></i> - mm
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Charts and historical data -->
    <div class="container my-4">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h2 class="h5 mb-0"><i class="fas fa-chart-line me-2"></i>Charts</h2>
            </div>
            <div class="card-body">
                <p class="card-text text-center">The charts show the trend of weather conditions over time</p>
                <div class="bg-light p-3 rounded text-center mb-3">
                    <!-- Placeholder for a chart -->
                    <img src="/api/placeholder/800/300" alt="Temperature chart" class="img-fluid rounded">
                </div>
                <div class="text-center">
                    <div class="btn-group">
                        <button type="button" class="btn btn-outline-primary active">Temperature</button>
                        <button type="button" class="btn btn-outline-primary">Humidity</button>
                        <button type="button" class="btn btn-outline-primary">Pressure</button>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <a href="./archivio-dati" class="text-decoration-none">View all historical data <i class="fas fa-arrow-right ms-1"></i></a>
            </div>
        </div>
    </div>

    <!-- Project info -->
    <div class="container my-4">
        <div class="row g-4">
            <div class="col-md-6">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h2 class="h5 mb-0"><i class="fas fa-school me-2"></i>Our Institute</h2>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-column h-100">
                            <div class="mb-3 text-center">
                                <img src="{{ url_for('static', filename='images/logo_itis.png') }}" alt="ITIS Mario Delpozzo" class="img-fluid rounded">
                            </div>
                            <p>ITIS Mario Delpozzo in Cuneo is a cutting-edge technical institute that promotes technological innovation and scientific education. Our weather station is an educational project that involves students from the electronics and computer science track.</p>
                            <div class="mt-auto">
                                <a href="https://www.itiscuneo.edu.it/" class="btn btn-outline-primary" target="_blank">Visit the school website</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h2 class="h5 mb-0"><i class="fas fa-flask me-2"></i>The Educational Project</h2>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-column h-100">
                            <p>The weather station at ITIS Mario Delpozzo was built by fourth and fifth-year students as a multidisciplinary project that involves:</p>
                            <ul>
                                <li>Design and construction of weather sensors</li>
                                <li>Programming microcontrollers for data acquisition</li>
                                <li>Software development for processing and visualization</li>
                                <li>Study of local meteorological phenomena</li>
                            </ul>
                            <p>The collected data is used for studies on the microclimate of the Cuneo area and is available to the scientific community.</p>
                            <div class="mt-auto">
                                <a href="./project" class="btn btn-outline-primary">Learn more about the project</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>ITIS Mario Delpozzo - Weather Station</h5>
                    <address>
                        <i class="fas fa-map-marker-alt me-2"></i> Corso Alcide De Gasperi, 30 - 12100 Cuneo<br>
                        <i class="fas fa-phone me-2"></i> Phone: 0171 634091<br>
                        <i class="fas fa-envelope me-2"></i> Email: stazionemeteo@itisdelpozzo.edu.it
                    </address>
                </div>
                <div class="col-md-6 text-md-end">
                    <h5>Quick Links</h5>
                    <ul class="list-inline">
                        <li class="list-inline-item"><a href="./" class="text-white">Home</a></li>
                        <li class="list-inline-item"><a href="./data_archive" class="text-white">Data Archive</a></li>
                        <li class="list-inline-item"><a href="./live_data" class="text-white">Live Data</a></li>
                        <li class="list-inline-item"><a href="./project" class="text-white">The Project</a></li>
                        <li class="list-inline-item"><a href="./csp" class="text-white">Citizen science platform</a></li>
                        <li class="list-inline-item"><a href="https://www.itiscuneo.edu.it/" class="text-white" target="_blank">The School</a></li>
                    </ul>
                    <div class="mt-3">
                        <a href="https://www.facebook.com/ITISdelpozzo/" class="text-white me-2"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-white me-2"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-white me-2"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.youtube.com/@itisdelpozzocuneo3140" class="text-white"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-3">
            <div class="text-center">
                <small>© 2025 ITIS Mario Delpozzo - Weather Station of Cuneo. Developed by students of the Robotics track.</small>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // CLAUDE GENERATED
        function fetchWeatherData() {
    fetch('/api/grafici')
        .then(response => response.json())
        .then( data => {
            // Validate and process data before creating charts
            if (data && data.length > 0) {
                console.log("Received data:", data);  // Debug log
                createWeatherCharts(data);
            } else {
                throw new Error("No data received");
            }
        })
        .catch(error => {
            console.error('Error fetching weather data:', error);
            const chartContainer = document.querySelector('.bg-light.p-3.rounded.text-center.mb-3');
            chartContainer.innerHTML = `
                <div class="alert alert-warning" role="alert">
                    Unable to load chart data. ${error.message}
                </div>
            `;
        });
}
function createWeatherCharts(data) {
    // Ensure Chart.js is loaded
    if (typeof Chart === 'undefined') {
        console.error('Chart.js is not loaded');
        return;
    }

    // Validate and transform data
    const processedData = data.map(entry => {
        // Check if entry has valid data
        if (entry.temperature === undefined || 
            entry.timestamp === undefined || 
            entry.barometer === undefined || 
            entry.outside_humidity === undefined) {
            console.warn("Invalid data entry:", entry);
            return null;
        }

        // Try parsing the timestamp
        let parsedDate;
        try {
            parsedDate = new Date(entry.timestamp);
            
            // Fallback if Date parsing fails
            if (isNaN(parsedDate.getTime())) {
                console.warn("Invalid timestamp:", entry.timestamp);
                return null;
            }
        } catch (error) {
            console.warn("Date parsing error:", error);
            return null;
        }

        return {
            temperature: parseFloat(entry.temperature),
            barometer: parseFloat(entry.barometer),
            humidity: parseFloat(entry.outside_humidity),
            timestamp: parsedDate
        };
    }).filter(entry => entry !== null);  // Remove invalid entries

    // Check if we have any valid data
    if (processedData.length === 0) {
        document.getElementById('charts-container').innerHTML = 'No valid data available';
        return;
    }

    // Sort data by timestamp to ensure chronological order
    processedData.sort((a, b) => a.timestamp - b.timestamp);

    // Prepare labels and data for each metric
    const labels = processedData.map(entry => 
        entry.timestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
    );

    // Create charts for each weather metric
    const chartConfigs = [
        {
            id: 'temperature-chart',
            label: 'Temperature (°C)',
            data: processedData.map(entry => entry.temperature),
            color: 'rgb(75, 192, 192)',
            title: 'Temperature in the last 24 hours',
            yAxis: {
                min: -10,
                max: 40,
                stepSize: 5
            }
        },
        {
            id: 'pressure-chart',
            label: 'Pressure (hPa)',
            data: processedData.map(entry => entry.barometer),
            color: 'rgb(255, 99, 132)',
            title: 'Atmospheric pressure in the last 24 hours',
            yAxis: {
                min: 900,
                max: 1100,
                stepSize: 20
            }
        },
        {
            id: 'humidity-chart',
            label: 'Humidity (%)',
            data: processedData.map(entry => entry.humidity),
            color: 'rgb(54, 162, 235)',
            title: 'Humidity in the last 24 hours',
            yAxis: {
                min: 0,
                max: 100,
                stepSize: 10
            }
        }
    ];

    // Create charts
    chartConfigs.forEach(config => {
        const ctx = document.getElementById(config.id);
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: config.label,
                    data: config.data,
                    borderColor: config.color,
                    backgroundColor: config.color.replace('rgb', 'rgba').replace(')', ', 0.2)'),
                    borderWidth: 2,
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: config.title
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    y: {
                        min: config.yAxis.min,
                        max: config.yAxis.max,
                        ticks: {
                            stepSize: config.yAxis.stepSize
                        },
                        title: {
                            display: true,
                            text: config.label
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Time'
                        }
                    }
                }
            }
        });
    });
}
// Modify the HTML to add canvases for the charts and update button functionality
document.addEventListener('DOMContentLoaded', function() {
    // Replace the placeholder image with chart canvases
    const chartsContainer = document.querySelector('.bg-light.p-3.rounded.text-center.mb-3');
    chartsContainer.innerHTML = `
        <div id="charts-container">
            <canvas id="temperature-chart" class="img-fluid rounded mb-3"></canvas>
            <canvas id="pressure-chart" class="img-fluid rounded mb-3"></canvas>
            <canvas id="humidity-chart" class="img-fluid rounded"></canvas>
        </div>
    `;
    document.getElementById('pressure-chart').style.display = 'none';
    document.getElementById('humidity-chart').style.display = 'none';
    
    // Update button functionality
    const buttons = document.querySelectorAll('.btn-group .btn');
    buttons.forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all buttons
            buttons.forEach(btn => btn.classList.remove('active'));
            // Add active class to clicked button
            this.classList.add('active');
            
            // Show corresponding chart
            const chartContainer = document.getElementById('charts-container');
            const charts = chartContainer.querySelectorAll('canvas');
            charts.forEach(chart => chart.style.display = 'none');
            
            switch(this.textContent.trim()) {
                case 'Temperature':
                    document.getElementById('temperature-chart').style.display = 'block';
                    break;
                case 'Humidity':
                    document.getElementById('humidity-chart').style.display = 'block';
                    break;
                case 'Pressure':
                    document.getElementById('pressure-chart').style.display = 'block';
                    break;
                default:
                    charts.forEach(chart => chart.style.display = 'block');
            }
        });
    });
    
    // Fetch weather data when the page loads
    fetchWeatherData();
});
    </script>
</body>
</html>